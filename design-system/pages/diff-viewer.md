# Diff 对比 / 冲突解决页 (Diff Viewer)

> **呈现方式**: `@shadcn/dialog` 全屏覆盖层（宽度 90vw，高度 85vh）
> **触发入口**: 同步中心「查看 Diff」/ 安装向导冲突 / Git 导入冲突 / Skill 详情页部署对比
> **继承**: MASTER.md 全部规范

---

## 页面概述

文件内容差异对比和冲突合并界面。支持双栏 Diff（两版本对比）和三向合并（原始 + 本地修改 + 新版本）。逐文件展示差异，支持在界面中直接选择版本或手动编辑合并。

---

## 区域划分

### 顶部信息栏

- Skill 名称（H2，Varela Round）
- 对比说明（Caption）："本地 Skill 库版本 vs 项目 A / Windsurf 部署版本"
- 文件切换标签：当 Skill 包含多个文件时，用 `@shadcn/tabs` 水平切换
  - 当前文件高亮（`peach-100` 底）
  - 有差异的文件标注蜂蜜橙圆点
  - 无差异的文件标注薄荷绿 ✓
- 右上角操作：
  - 「关闭」Icon 按钮（Lucide: `x`）
  - 「全屏」Icon 按钮（Lucide: `maximize-2`）

---

### 双栏 Diff 模式（默认）

左右并排展示两个版本：

**左栏**：版本 A（如"本地 Skill 库"）
- 标题栏：版本名称 + 版本号 + 修改时间（Caption）
- 背景：`white`

**右栏**：版本 B（如"项目 A / Windsurf"）
- 标题栏：同上
- 背景：`white`

**Diff 渲染规则**：
- 代码字体：JetBrains Mono，14px
- 行号：`cream-400` 色，左对齐
- 新增行：`mint/10` 背景 + 左侧 3px 薄荷绿色条
- 删除行：`strawberry/10` 背景 + 左侧 3px 草莓红色条
- 修改行：`sunset/10` 背景 + 左侧 3px 蜂蜜橙色条
- 未变行：`white` 背景
- `@shadcn/collapsible` 折叠未变区域：显示 "... 省略 N 行 ..."（可点击展开）
- 双栏同步滚动
- 变更区域间有空行分隔

**行内 Diff**（同一行中的差异）：
- 删除的文字：`strawberry/20` 背景 + 删除线
- 新增的文字：`mint/20` 背景 + 加粗

---

### 三向合并模式

当存在三个版本（原始 / 本地修改 / 新版本）时启用：

```
+------------------+------------------+------------------+
| 原始版本 (Base)   | 本地修改 (Local)  | 新版本 (Remote)  |
+------------------+------------------+------------------+
|                  |                  |                  |
| (只读)           | (只读)           | (只读)           |
|                  |                  |                  |
+------------------+------------------+------------------+
|               合并结果 (可编辑)                          |
+--------------------------------------------------------+
```

- 上方三栏：只读展示三个版本（各 1/3 宽度）
- 下方一栏：合并结果编辑区
  - 可直接编辑
  - 冲突区域高亮（`sunset/10` 背景 + 蜂蜜橙虚线边框）
  - 每个冲突块旁有快捷按钮：「用左」/「用中」/「用右」

---

### 底部操作栏

固定在底部，`white/90 backdrop-blur` 背景 + `shadow-soft`：

- 统计信息（Caption）："共 5 处差异，3 处冲突"
- 导航按钮：`@shadcn/button` outline 「上一处差异」/「下一处差异」（Lucide: `chevron-up`/`chevron-down`）
- 操作按钮：
  - **双栏模式**：
    - 「使用版本 A」Primary Clay
    - 「使用版本 B」Outline
    - 「手动合并」Secondary（切换到三向合并模式）
  - **三向合并模式**：
    - 「保存合并结果」Primary Clay
    - 「取消」Ghost

---

## 动画

- 进入：scaleIn（从 0.95 缩放 + 渐显）
- 退出：缩小 + 渐隐
- 差异导航：点击「下一处差异」时，目标行滚动到视口中央 + 短暂黄色高亮闪烁（300ms fade）
- 文件 Tab 切换：内容区 fadeInUp 过渡
- GSAP ScrollTrigger：滚动到变更区域时，左侧色条有短暂加亮脉动

---

## 异步操作

| 操作 | 加载方式 |
|------|---------|
| 计算 Diff | `@shadcn/spinner` BounceDots（500ms ~ 2s） |
| 加载文件内容 | `@shadcn/skeleton` 编辑区骨架屏（< 500ms） |
| 保存合并结果 | 按钮 loading（< 1s） |
| 同步合并结果到部署位置 | 按钮 loading → 逐项进度（500ms ~ 5s） |

---

## 键盘快捷键

| 快捷键 | 操作 |
|--------|------|
| `↑` / `↓` 或 `N` / `P` | 上一处/下一处差异 |
| `Escape` | 关闭 Diff 视图 |
| `1` / `2` / `3` | 三向合并中选择版本 1/2/3 |
| `Cmd/Ctrl + S` | 保存合并结果 |